<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>this关键字 | 长街有风</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="shortcut icon" href="/goodBlog/favicon.ico" type="iamge/x-icon">
    <meta name="description" content="记录学习中的点点滴滴">
    <meta name="keywords" content="长街有风 前端 前端文章">
    
    <link rel="preload" href="/goodBlog/assets/css/0.styles.1a45a8ae.css" as="style"><link rel="preload" href="/goodBlog/assets/js/app.d28268c4.js" as="script"><link rel="preload" href="/goodBlog/assets/js/2.d2277413.js" as="script"><link rel="preload" href="/goodBlog/assets/js/90.002533a8.js" as="script"><link rel="preload" href="/goodBlog/assets/js/4.7b44c081.js" as="script"><link rel="preload" href="/goodBlog/assets/js/3.6a3c886d.js" as="script"><link rel="prefetch" href="/goodBlog/assets/js/10.05c2e5d3.js"><link rel="prefetch" href="/goodBlog/assets/js/100.89e3a374.js"><link rel="prefetch" href="/goodBlog/assets/js/101.f8cf1994.js"><link rel="prefetch" href="/goodBlog/assets/js/11.f03ca467.js"><link rel="prefetch" href="/goodBlog/assets/js/12.076a4731.js"><link rel="prefetch" href="/goodBlog/assets/js/13.d2471796.js"><link rel="prefetch" href="/goodBlog/assets/js/14.aa370daa.js"><link rel="prefetch" href="/goodBlog/assets/js/15.ce3ac647.js"><link rel="prefetch" href="/goodBlog/assets/js/16.852e98ff.js"><link rel="prefetch" href="/goodBlog/assets/js/17.93f57baa.js"><link rel="prefetch" href="/goodBlog/assets/js/18.9ba53fbd.js"><link rel="prefetch" href="/goodBlog/assets/js/19.0ff053ed.js"><link rel="prefetch" href="/goodBlog/assets/js/20.bd53997c.js"><link rel="prefetch" href="/goodBlog/assets/js/21.8ffe8741.js"><link rel="prefetch" href="/goodBlog/assets/js/22.ae7d0029.js"><link rel="prefetch" href="/goodBlog/assets/js/23.53afd0d5.js"><link rel="prefetch" href="/goodBlog/assets/js/24.bd29090d.js"><link rel="prefetch" href="/goodBlog/assets/js/25.00e6af77.js"><link rel="prefetch" href="/goodBlog/assets/js/26.35165b68.js"><link rel="prefetch" href="/goodBlog/assets/js/27.a2e90537.js"><link rel="prefetch" href="/goodBlog/assets/js/28.838ac013.js"><link rel="prefetch" href="/goodBlog/assets/js/29.959b44d0.js"><link rel="prefetch" href="/goodBlog/assets/js/30.61a94ea6.js"><link rel="prefetch" href="/goodBlog/assets/js/31.d8dbba38.js"><link rel="prefetch" href="/goodBlog/assets/js/32.2195566d.js"><link rel="prefetch" href="/goodBlog/assets/js/33.3f6e9870.js"><link rel="prefetch" href="/goodBlog/assets/js/34.7a02b405.js"><link rel="prefetch" href="/goodBlog/assets/js/35.3a62b3c5.js"><link rel="prefetch" href="/goodBlog/assets/js/36.caada6f2.js"><link rel="prefetch" href="/goodBlog/assets/js/37.7740cdf0.js"><link rel="prefetch" href="/goodBlog/assets/js/38.6151e77b.js"><link rel="prefetch" href="/goodBlog/assets/js/39.33134a34.js"><link rel="prefetch" href="/goodBlog/assets/js/40.82ce5221.js"><link rel="prefetch" href="/goodBlog/assets/js/41.3d295fb8.js"><link rel="prefetch" href="/goodBlog/assets/js/42.ad3b9012.js"><link rel="prefetch" href="/goodBlog/assets/js/43.c5a12d58.js"><link rel="prefetch" href="/goodBlog/assets/js/44.570946d0.js"><link rel="prefetch" href="/goodBlog/assets/js/45.4e91972d.js"><link rel="prefetch" href="/goodBlog/assets/js/46.bb2a880d.js"><link rel="prefetch" href="/goodBlog/assets/js/47.03e818e0.js"><link rel="prefetch" href="/goodBlog/assets/js/48.6e9a3ab4.js"><link rel="prefetch" href="/goodBlog/assets/js/49.408fda99.js"><link rel="prefetch" href="/goodBlog/assets/js/5.02f0798d.js"><link rel="prefetch" href="/goodBlog/assets/js/50.3993d4c7.js"><link rel="prefetch" href="/goodBlog/assets/js/51.240d7d96.js"><link rel="prefetch" href="/goodBlog/assets/js/52.1dacb3a3.js"><link rel="prefetch" href="/goodBlog/assets/js/53.d99ee58d.js"><link rel="prefetch" href="/goodBlog/assets/js/54.119f8150.js"><link rel="prefetch" href="/goodBlog/assets/js/55.4d39b183.js"><link rel="prefetch" href="/goodBlog/assets/js/56.72765c69.js"><link rel="prefetch" href="/goodBlog/assets/js/57.25c2728c.js"><link rel="prefetch" href="/goodBlog/assets/js/58.93c4de40.js"><link rel="prefetch" href="/goodBlog/assets/js/59.07330fc9.js"><link rel="prefetch" href="/goodBlog/assets/js/6.f2844f3b.js"><link rel="prefetch" href="/goodBlog/assets/js/60.a9264c75.js"><link rel="prefetch" href="/goodBlog/assets/js/61.dcf4116c.js"><link rel="prefetch" href="/goodBlog/assets/js/62.c3783996.js"><link rel="prefetch" href="/goodBlog/assets/js/63.51b99bd0.js"><link rel="prefetch" href="/goodBlog/assets/js/64.a2055924.js"><link rel="prefetch" href="/goodBlog/assets/js/65.4d8ac745.js"><link rel="prefetch" href="/goodBlog/assets/js/66.c0ff17e2.js"><link rel="prefetch" href="/goodBlog/assets/js/67.1cebd1da.js"><link rel="prefetch" href="/goodBlog/assets/js/68.3ac34f13.js"><link rel="prefetch" href="/goodBlog/assets/js/69.66122a21.js"><link rel="prefetch" href="/goodBlog/assets/js/7.d712acc0.js"><link rel="prefetch" href="/goodBlog/assets/js/70.cf684b73.js"><link rel="prefetch" href="/goodBlog/assets/js/71.3f6457ac.js"><link rel="prefetch" href="/goodBlog/assets/js/72.5c597fbf.js"><link rel="prefetch" href="/goodBlog/assets/js/73.cb25ed57.js"><link rel="prefetch" href="/goodBlog/assets/js/74.45e7e30c.js"><link rel="prefetch" href="/goodBlog/assets/js/75.5462c8ff.js"><link rel="prefetch" href="/goodBlog/assets/js/76.9d48239d.js"><link rel="prefetch" href="/goodBlog/assets/js/77.fdd6937e.js"><link rel="prefetch" href="/goodBlog/assets/js/78.694293b3.js"><link rel="prefetch" href="/goodBlog/assets/js/79.d9d0b208.js"><link rel="prefetch" href="/goodBlog/assets/js/8.ea8178e6.js"><link rel="prefetch" href="/goodBlog/assets/js/80.eaab824c.js"><link rel="prefetch" href="/goodBlog/assets/js/81.02958dbf.js"><link rel="prefetch" href="/goodBlog/assets/js/82.e9176cac.js"><link rel="prefetch" href="/goodBlog/assets/js/83.ebe9efcd.js"><link rel="prefetch" href="/goodBlog/assets/js/84.57d2a35b.js"><link rel="prefetch" href="/goodBlog/assets/js/85.644297a0.js"><link rel="prefetch" href="/goodBlog/assets/js/86.8dc4a8c3.js"><link rel="prefetch" href="/goodBlog/assets/js/87.3a9b6fab.js"><link rel="prefetch" href="/goodBlog/assets/js/88.469cfb5f.js"><link rel="prefetch" href="/goodBlog/assets/js/89.0d83276b.js"><link rel="prefetch" href="/goodBlog/assets/js/9.a872d56c.js"><link rel="prefetch" href="/goodBlog/assets/js/91.44d2f90c.js"><link rel="prefetch" href="/goodBlog/assets/js/92.9b0453a7.js"><link rel="prefetch" href="/goodBlog/assets/js/93.5dbf6406.js"><link rel="prefetch" href="/goodBlog/assets/js/94.5ecddf2f.js"><link rel="prefetch" href="/goodBlog/assets/js/95.9973d547.js"><link rel="prefetch" href="/goodBlog/assets/js/96.b230b097.js"><link rel="prefetch" href="/goodBlog/assets/js/97.a8be5d24.js"><link rel="prefetch" href="/goodBlog/assets/js/98.b93b29b6.js"><link rel="prefetch" href="/goodBlog/assets/js/99.a90f341b.js">
    <link rel="stylesheet" href="/goodBlog/assets/css/0.styles.1a45a8ae.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/goodBlog/" class="home-link router-link-active"><!----> <span class="site-name">长街有风</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/goodBlog/" class="nav-link">主页</a></div><div class="nav-item"><a href="/goodBlog/webframe/" class="nav-link router-link-active">前端</a></div><div class="nav-item"><a href="/goodBlog/interview/" class="nav-link">面试问题</a></div><div class="nav-item"><a href="/goodBlog/flutter/" class="nav-link">Flutter</a></div><div class="nav-item"><a href="/goodBlog/experience/" class="nav-link">项目经验</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关注 Menu" class="dropdown-title"><span class="title">关注</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://www.ruanyifeng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  阮一峰的个人网站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.inode.club/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  程序员成长指北
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://aotu.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  凹凸实验室
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/goodBlog/" class="nav-link">主页</a></div><div class="nav-item"><a href="/goodBlog/webframe/" class="nav-link router-link-active">前端</a></div><div class="nav-item"><a href="/goodBlog/interview/" class="nav-link">面试问题</a></div><div class="nav-item"><a href="/goodBlog/flutter/" class="nav-link">Flutter</a></div><div class="nav-item"><a href="/goodBlog/experience/" class="nav-link">项目经验</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关注 Menu" class="dropdown-title"><span class="title">关注</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://www.ruanyifeng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  阮一峰的个人网站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.inode.club/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  程序员成长指北
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://aotu.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  凹凸实验室
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <div class="my_introduce" style="padding-left:1rem;"><div class="introduce_component" data-v-ef03d332><img src="/goodBlog/small.jpg" alt data-v-ef03d332> <div class="intro_content" data-v-ef03d332><h3 data-v-ef03d332>长街有风</h3> <p data-v-ef03d332>十里长安街，有风徐徐来</p></div></div></div> <ul class="sidebar-links"><li><a href="/goodBlog/webframe/" aria-current="page" class="sidebar-link">目录</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>css</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="为什么要学习this关键字"><a href="#为什么要学习this关键字" class="header-anchor">#</a> 为什么要学习this关键字</h2> <ol><li><p>面试会问啊！
总有一些面试官喜欢问你一段不可能这么写的代码。
看一道经典且古老的面试题(学完本文后，末尾会有一道更复杂的面试题等着你哦！)</p> <p>代码如下:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  a <span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  <span class="token function-variable function">foo</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> bar <span class="token operator">=</span> obj<span class="token punctuation">.</span>foo
obj<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>我在读 Events 的 lib/events 源码的时候发现多次用到call关键字，看来有必要搞懂 this 与 call 相关的所有内容。</p> <p>其中几句代码是这样写的</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 场景1:</span>
<span class="token keyword">function</span> <span class="token function">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  EventEmitter<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 场景2:</span>
<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">listener</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 场景3:</span>
<span class="token keyword">return</span> <span class="token function">listenerCount</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>emitter<span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>箭头函数使用不当报错，在封装 Node.js 的一个 ORM 映射框架 Sequelize 时，封装表关联关系，由于使用箭头函数造成了读到的上下文发生变化，不是想要的 model 信息，而是指向了全局 。</p></li> <li><p>call 关键字在写代码过程中还是比较常用的，有时候我们常常会使用 call 关键字来指定某个函数运行时的上下文，有时候还使用 call 关键字实现继承。</p></li></ol> <p>代码例子如下:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;koala&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">changeJob</span><span class="token punctuation">(</span><span class="token parameter">company<span class="token punctuation">,</span> work</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>company <span class="token operator">=</span> company<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>work    <span class="token operator">=</span> work<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">changeJob</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> <span class="token string">'百度'</span><span class="token punctuation">,</span> <span class="token string">'程序员'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>work<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '程序员'</span>
</code></pre></div><h2 id="文章概览图"><a href="#文章概览图" class="header-anchor">#</a> 文章概览图</h2> <p><img src="https://user-gold-cdn.xitu.io/2019/9/11/16d1dc3fe9fe710a?w=880&amp;h=966&amp;f=jpeg&amp;s=141780" alt="文章概览图" title=":size=600"></p> <blockquote><p>注:本文中如不特殊说明都是，输出结果都是指浏览器中输出结果。
Github 博客开源项目 https://github.com/koala-coding/goodBlog</p></blockquote> <h2 id="函数调用"><a href="#函数调用" class="header-anchor">#</a> 函数调用</h2> <p>JS（ES5）里面有三种函数调用形式：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">func</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span> 
obj<span class="token punctuation">.</span>child<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span>
<span class="token function">func</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span> <span class="token comment">// 这里先不讲 apply</span>
</code></pre></div><p>好多初学者都只用到过前两种情况，而且认为前两者优于第三者。直到几天前想系统复习一下this关键字，找this相关的各种资料，在知乎看到了一个关于this的讨论。
说第三种形式才是正常的调用形式。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">func</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span>p1<span class="token punctuation">,</span>p2<span class="token punctuation">)</span>
</code></pre></div><p>其它两种都是语法糖，可以等价的变为<code>call</code>形式。
<code>func(p1, p2)等价于 func.call(undefined, p1, p2);</code></p> <p><code>obj.child.method(p1, p2) 等价于 obj.child.method.call(obj.child, p1, p2);</code>
这么看我们的函数调用只有一种形式:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">func</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span>p1<span class="token punctuation">,</span>p2<span class="token punctuation">)</span>
</code></pre></div><p>这时候是不是就知道this是什么了，就是上面的context。回到我开篇提到的面试题。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  a <span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  <span class="token function-variable function">foo</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> bar <span class="token operator">=</span> obj<span class="token punctuation">.</span>foo
obj<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>obj.foo() 转化为call的形式就是obj.foo.call(obj)</li></ul> <p>所以this指向了obj</p> <ul><li>bar() 转化为call的形式就是bar.call()
由于没有传 context，所以 this 就是 undefined。
如果是在浏览器中，默认的 this 就是 window 对象；如果是在 Node.js 环境中默认的 this 就是 global 对象。
最终，在浏览器中运行结果为 5；在 Node.js 环境中为 undefined。</li></ul> <h3 id="node-js-环境下指向全局的this关键字说明-你可能不知道"><a href="#node-js-环境下指向全局的this关键字说明-你可能不知道" class="header-anchor">#</a> Node.js 环境下指向全局的this关键字说明(你可能不知道)</h3> <p>为什么在浏览器或者前端环境可以直接正常输出值，而在 Node.js 环境中输出的却是<code>undefined</code>。
看一下这段代码你可能就懂了。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> require<span class="token punctuation">,</span> module<span class="token punctuation">,</span> __filename<span class="token punctuation">,</span> __dirname</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">{</span>
    <span class="token comment">// 模块的代码</span>
    <span class="token comment">// 所以那整个代码应该在这里吧</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// const haha = new A();</span>
    <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>先说一下 Node.js 环境下在运行某个 js 模块代码时候发生了什么，Node.js 在执行代码之前会使用一个代码封装器进行封装，例如下面所示：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> require<span class="token punctuation">,</span> module<span class="token punctuation">,</span> __filename<span class="token punctuation">,</span> __dirname</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">{</span>
    <span class="token comment">// 模块的代码</span>
    <span class="token comment">// 所以那整个代码应该在这里吧</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这段代码在 Node.js 环境下输出结果为<code>5，undefined</code>是不是就能理解了。
这里面的this是默认绑定指向全局，当输出this.a的时候，全局应该指向这个闭包的最外层。所以输出结果式是undefined。</p> <h3 id="语法中的this关键字"><a href="#语法中的this关键字" class="header-anchor">#</a> []语法中的this关键字</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">fn</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span>fn<span class="token punctuation">,</span> fn2<span class="token punctuation">]</span>
arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 这里面的 this 又是什么呢？ </span>
</code></pre></div><p>我们可以把 arr<a href="">0</a> 想象为arr.0( )，虽然后者的语法错了，但是形式与转换代码里的 obj.child.method(p1, p2) 对应上了，于是就可以愉快的转换了：</p> <div class="language- extra-class"><pre class="language-text"><code>        arr[0]() 
假想为    arr.0()
然后转换为 arr.0.call(arr)
那么里面的 this 就是 arr 了
</code></pre></div><h2 id="this绑定原则"><a href="#this绑定原则" class="header-anchor">#</a> this绑定原则</h2> <h3 id="默认绑定"><a href="#默认绑定" class="header-anchor">#</a> 默认绑定</h3> <p>默认绑定是函数针对的独立调用的时候，不带任何修饰的函数引用进行调用，非严格模式下 this 指向全局对象(浏览器下指向 Window，Node.js 环境是 Global ），严格模式下，this 绑定到 undefined ,严格模式不允许this指向全局对象。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token string">'hello'</span>

<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    a<span class="token operator">:</span> <span class="token string">'koala'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">foo</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> bar <span class="token operator">=</span> obj<span class="token punctuation">.</span>foo

<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>              <span class="token comment">// 浏览器中输出: &quot;hello&quot;</span>
</code></pre></div><p>这段代码，<code>bar()</code>就是默认绑定，函数调用的时候，前面没有任何修饰调用，也可以用之前的 <code>call</code>函数调用形式理解，所以输出结果是<code>hello</code>。</p> <h4 id="默认绑定的另一种情况"><a href="#默认绑定的另一种情况" class="header-anchor">#</a> 默认绑定的另一种情况</h4> <p>在函数中以函数作为参数传递，例如<code>setTimeOut</code>和<code>setInterval</code>等，这些函数中传递的函数中的<code>this</code>指向，在非严格模式指向的是全局对象。</p> <p>例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'koala'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'程序员成长指北'</span><span class="token punctuation">,</span>
    sayHi<span class="token operator">:</span> sayHi
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello,'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
person<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    person<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 输出结果 Hello,koala</span>
<span class="token comment">// 输出结果 Hello,koala</span>
</code></pre></div><h3 id="隐式绑定"><a href="#隐式绑定" class="header-anchor">#</a> 隐式绑定</h3> <p>判断 this 隐式绑定的基本标准:函数调用的时候是否在上下文中调用，或者说是否某个对象调用函数。</p> <p>例子:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token string">'koala'</span>

<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    a<span class="token operator">:</span> <span class="token string">'程序员成长指北'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">foo</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
obj<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>       <span class="token comment">// 浏览器中输出: &quot;程序员成长指北&quot;</span>
</code></pre></div><p>foo 方法是作为对象的属性调用的，那么此时 foo 方法执行时，this 指向 obj 对象。</p> <p><strong>隐式绑定的另一种情况</strong></p> <p>当有多层对象嵌套调用某个函数的时候，如 <code>对象.对象.函数</code>,this 指向的是最后一层对象。</p> <p>例子:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello,'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> person2 <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'程序员成长指北'</span><span class="token punctuation">,</span>
    sayHi<span class="token operator">:</span> sayHi
<span class="token punctuation">}</span>
<span class="token keyword">var</span> person1 <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'koala'</span><span class="token punctuation">,</span>
    friend<span class="token operator">:</span> person2
<span class="token punctuation">}</span>
person1<span class="token punctuation">.</span>friend<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 输出结果为 Hello, 程序员成长指北</span>
</code></pre></div><p>看完这个例子，是不是也就懂了隐式调用的这种情况。</p> <h3 id="显式绑定"><a href="#显式绑定" class="header-anchor">#</a> 显式绑定</h3> <p>显式绑定，通过函数call apply bind 可以修改函数this的指向。call 与 apply 方法都是挂载在 Function 原型下的方法，所有的函数都能使用。</p> <h4 id="call-和-apply-的区别"><a href="#call-和-apply-的区别" class="header-anchor">#</a> call 和 apply 的区别</h4> <ol><li>call和apply的第一个参数会绑定到函数体的this上，如果<code>不传参数</code>，例如<code>fun.call()</code>，非严格模式，this默认还是绑定到全局对象</li> <li>call函数接收的是一个参数列表，apply函数接收的是一个参数数组。</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">unc</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>thisArg<span class="token punctuation">,</span> arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">)</span>        <span class="token comment">// call 用法</span>
<span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>thisArg<span class="token punctuation">,</span> <span class="token punctuation">[</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">)</span>     <span class="token comment">// apply 用法</span>
</code></pre></div><p>看代码例子:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;koala&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">changeJob</span><span class="token punctuation">(</span><span class="token parameter">company<span class="token punctuation">,</span> work</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>company <span class="token operator">=</span> company<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>work    <span class="token operator">=</span> work<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">changeJob</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> <span class="token string">'百度'</span><span class="token punctuation">,</span> <span class="token string">'程序员'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>work<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '程序员'</span>

<span class="token function">changeJob</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'百度'</span><span class="token punctuation">,</span> <span class="token string">'测试'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>work<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '测试'</span>
</code></pre></div><h4 id="call和apply的注意点"><a href="#call和apply的注意点" class="header-anchor">#</a> call和apply的注意点</h4> <p>这两个方法在调用的时候，如果我们传入数字或者字符串，这两个方法会把传入的参数转成对象类型。</p> <p>例子:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> number <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> string <span class="token operator">=</span> <span class="token string">'程序员成长指北'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">getThisType</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> number <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'this指向内容'</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">getThisType</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">getThisType</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 输出结果</span>
<span class="token comment">// this指向内容 [Number: 1]</span>
<span class="token comment">// object</span>
<span class="token comment">// this指向内容 [String: '程序员成长指北']</span>
<span class="token comment">// object</span>
</code></pre></div><h4 id="bind函数"><a href="#bind函数" class="header-anchor">#</a> bind函数</h4> <blockquote><p>bind 方法
会创建一个新函数。当这个新函数被调用时，bind() 的第一个参数将作为它运行时的 this，之后的一序列参数将会在传递的实参前传入作为它的参数。(定义内容来自于 MDN )</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">func</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>thisArg<span class="token punctuation">[</span><span class="token punctuation">,</span> arg1<span class="token punctuation">[</span><span class="token punctuation">,</span> arg2<span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment">// bind 用法</span>
</code></pre></div><p>例子:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> publicAccounts <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'程序员成长指北'</span><span class="token punctuation">,</span>
    author<span class="token operator">:</span> <span class="token string">'koala'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">subscribe</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">subscriber</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>subscriber <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

publicAccounts<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'小红'</span><span class="token punctuation">)</span>   <span class="token comment">// 输出结果: &quot;小红 程序员成长指北&quot;</span>

<span class="token keyword">var</span> subscribe1 <span class="token operator">=</span> publicAccounts<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Node成长指北'</span><span class="token punctuation">,</span> author<span class="token operator">:</span> <span class="token string">'考拉'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'小明 '</span><span class="token punctuation">)</span>
<span class="token function">subscribe1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>       <span class="token comment">// 输出结果: &quot;小明 Node成长指北&quot;</span>
</code></pre></div><h3 id="new-绑定"><a href="#new-绑定" class="header-anchor">#</a> new 绑定</h3> <p>使用new调用函数的时候，会执行怎样的流程：</p> <ol><li>创建一个空对象</li> <li>将空对象的 <em>proto</em> 指向原对象的 prototype</li> <li><code>执行构造函数中的代码</code></li> <li>返回这个新对象</li></ol> <p>例子:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">study</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
	
<span class="token punctuation">}</span>
<span class="token keyword">var</span> studyDay <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">study</span><span class="token punctuation">(</span><span class="token string">'koala'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>studyDay<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello,'</span><span class="token punctuation">,</span> studyDay<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 输出结果</span>
<span class="token comment">// study { name: 'koala' }</span>
<span class="token comment">// hello，koala</span>
</code></pre></div><p>在<code>new study('koala')</code>的时候，会改变this指向，将<code>this指向指定到了studyDay对象</code>。
注意:如果创建新的对象，构造函数不传值的话，新对象中的属性不会有值，但是新的对象中会有这个属性。</p> <h4 id="手动实现一个new创建对象代码-多种实现方式哦"><a href="#手动实现一个new创建对象代码-多种实现方式哦" class="header-anchor">#</a> 手动实现一个new创建对象代码(多种实现方式哦)</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">New</span><span class="token punctuation">(</span><span class="token parameter">func</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>func<span class="token punctuation">.</span>prototype <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> func<span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> ret <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> ret <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> ret <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> ret <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token function">New</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// equals to</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="this绑定优先级"><a href="#this绑定优先级" class="header-anchor">#</a> this绑定优先级</h2> <p>上面介绍了 this 的四种绑定规则，但是一段代码有时候会同时应用多种规则，这时候 this 应该如何指向呢？其实它们也是有一个先后顺序的，具体规则如下:</p> <p><strong>new绑定 &gt; 显式绑定 &gt; 隐式绑定 &gt; 默认绑定</strong></p> <h2 id="箭头函数中的-this"><a href="#箭头函数中的-this" class="header-anchor">#</a> 箭头函数中的 this</h2> <h3 id="箭头函数"><a href="#箭头函数" class="header-anchor">#</a> 箭头函数</h3> <p>在讲箭头函数中的 this 之前，先讲一下箭头函数。</p> <p><strong>定义</strong></p> <blockquote><p>MDN:箭头函数表达式的语法比函数表达式更短，并且不绑定自己的this，arguments，super或 new.target。这些函数表达式最适合用于非方法函数(non-method functions)，并且它们不能用作构造函数。</p></blockquote> <ul><li>箭头函数中没有 arguments</li></ul> <p>常规函数可以直接拿到 arguments 属性，但是在箭头函数中如果使用 arguments 属性，拿到的是箭头函数外层函数的 arguments 属性。</p> <p>例子:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">constant</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">constant</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
</code></pre></div><p><strong>如果我们就是要访问箭头函数的参数呢？</strong></p> <p>你可以通过 ES6 中 命名参数 或者 rest 参数的形式访问参数</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> <span class="token function-variable function">nums</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>nums</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> nums<span class="token punctuation">;</span>
</code></pre></div><ul><li>箭头函数没有构造函数</li></ul> <p>箭头函数与正常的函数不同，箭头函数没有构造函数 constructor，因为没有构造函数，所以也不能使用 new 来调用，如果我们直接使用 new 调用箭头函数，会报错。</p> <p>例子:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> <span class="token function-variable function">fun</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">let</span> funNew <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 报错内容 TypeError: fun is not a constructor</span>
</code></pre></div><ul><li>箭头函数没有原型</li></ul> <p>原型 prototype 是函数的一个属性，但是对于箭头函数没有它。</p> <p>例子:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> <span class="token function-variable function">fun</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">loh</span><span class="token punctuation">(</span>fun<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
</code></pre></div><ul><li>箭头函数中没有 super</li></ul> <p>上面说了没有原型，连原型都没有，自然也不能通过 super 来访问原型的属性，所以箭头函数也是没有 super 的，不过跟 this、arguments、new.target 一样，这些值由外围最近一层非箭头函数决定。</p> <ul><li><code>箭头函数中没有自己的this</code></li></ul> <p>箭头函数中没有自己的 this，箭头函数中的 this 不能用 call()、apply()、bind() 这些方法改变 this 的指向，箭头函数中的 this 直接指向的是<code>调用函数的 上一层运行时</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token string">'kaola'</span>

<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    a<span class="token operator">:</span> <span class="token string">'程序员成长指北'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">foo</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

obj<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>             <span class="token comment">// 输出结果: &quot;koala&quot;</span>
</code></pre></div><p>看完输出结果，怕大家有疑问还是分析一下，前面我说的箭头函数中this直接指向的是<code>调用函数的上一层运行时</code>，这段代码<code>obj.foo</code>在调用的时候如果是不使用箭头函数this应该指向的是 obj ，但是使用了箭头函数，往上一层查找，指向的就是全局了，所以输出结果是<code>koala</code>。</p> <h3 id="自执行函数"><a href="#自执行函数" class="header-anchor">#</a> 自执行函数</h3> <p>什么是自执行函数？
自执行函数在我们在代码只能够定义后，无需调用，会自动执行。开发过程中有时间测试某一小段代码报错会使用。
代码例子如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'程序员成长指北'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>或者</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'程序员成长指北'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>但是如果使用了箭头函数简化一下就只能使用第一种情况了。使用第二种情况简化会报错。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'程序员成长指北'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="this应用场景"><a href="#this应用场景" class="header-anchor">#</a> this应用场景</h2> <p>应用场景其实就是开篇说到的为什么写这篇文章，再重复一下。</p> <ol><li>面试官他考！</li> <li>看源码总看见，有时候想确认一下当前的上下文指向。为什么源码中用的多，大家可以想想这个问题。</li> <li>我们写代码也会用，经常会出现用 call 指向某个对象的上下文，或者实现继承等等。</li></ol> <h2 id="学后小练习"><a href="#学后小练习" class="header-anchor">#</a> 学后小练习</h2> <p>学到这里是不是发现开篇那道面试题有点简单，已经不能满足你目前对于 this 关键字的知识储备。好的，我们来一道复杂点的面试题。</p> <p>代码如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> length <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  length<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
  <span class="token function-variable function">method</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
 
obj<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//输出是什么？</span>
</code></pre></div><p>这段代码的输出结果是:<code>10,2</code></p> <p>认真读文章的应该都能正确的答出答案，每一个细节文章中都讲了，我在这就不具体分析，如果不懂可以再读文章，或者直接加我好友我们一起讨论，kaola 是一个乐于分享的人，期待与你共同进步。</p> <p>声明:任何形式转载都请联系本人，如有问题也感谢您的指出和建议哦。</p> <h2 id="参考文章"><a href="#参考文章" class="header-anchor">#</a> 参考文章</h2> <ul><li>MDN中this关键字的讲解 https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/this</li> <li>知乎的一个关于this讨论 :https://www.zhihu.com/question/19636194</li> <li>阮一峰老师的ES6书籍中箭头函数内容</li> <li>书籍《你不知道的javascript》</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><!----><!----><!----></div></div>
    <script src="/goodBlog/assets/js/app.d28268c4.js" defer></script><script src="/goodBlog/assets/js/2.d2277413.js" defer></script><script src="/goodBlog/assets/js/90.002533a8.js" defer></script><script src="/goodBlog/assets/js/4.7b44c081.js" defer></script><script src="/goodBlog/assets/js/3.6a3c886d.js" defer></script>
  </body>
</html>
