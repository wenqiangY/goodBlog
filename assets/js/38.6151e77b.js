(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{405:function(s,t,a){"use strict";a.r(t);var e=a(25),r=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"android打包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#android打包"}},[s._v("#")]),s._v(" Android打包")]),s._v(" "),a("h3",{attrs:{id:"打包过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#打包过程"}},[s._v("#")]),s._v(" 打包过程")]),s._v(" "),a("h4",{attrs:{id:"_1-app-签名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-app-签名"}},[s._v("#")]),s._v(" 1. app 签名")]),s._v(" "),a("p",[s._v("如果您有现有 keystore，请跳至下一步。如果没有，请通过在运行以下命令来创建一个：")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("keytool -genkey -v -keystore D:/key.jks -keyalg RSA -keysize "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v(" -validity "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v(" -alias key\n")])])]),a("ul",[a("li",[s._v("-keystore 参数后的值：D:/key.jks 是在D盘下生成一个"),a("code",[s._v("key.jks")]),s._v("的文件。文件名称可以自定义。")]),s._v(" "),a("li",[s._v("-alias 参数后面的值：key 是app签名文件的别名，不一定是key也可以自定义别名。\n"),a("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2020/1/10/16f8ea589d697b4e?w=977&h=575&f=png&s=29178",alt:"key"}}),s._v("\n把生成好的文件找一目录放好。"),a("br"),s._v("\n注意: 保持文件私密; 不要将它加入公共源代码控制中。")])]),s._v(" "),a("h4",{attrs:{id:"_2-配置key"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置key"}},[s._v("#")]),s._v(" 2. 配置key")]),s._v(" "),a("p",[s._v("在项目android目录下新建文件 “ "),a("strong",[s._v("key.properties")]),s._v(" ”")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("storePassword"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("密匙库口令\nkeyPassword"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("key密匙口令\nkeyAlias"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("key别名\nstoreFile"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("路径\n\n列如：\nstorePassword"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\nkeyPassword"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\nkeyAlias"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("key\nstoreFile"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("D")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("001")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("001")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("flutter"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jks\n")])])]),a("h4",{attrs:{id:"_3-配置build-gradle"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置build-gradle"}},[s._v("#")]),s._v(" 3. 配置build.gradle")]),s._v(" "),a("p",[s._v("3.1. 打开"),a("code",[s._v("android/app/build.gradle")]),s._v("文件"),a("br"),s._v("\n找到")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("android "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n")])])]),a("p",[s._v("在android {之前加上以下三句")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("def keystorePropertiesFile "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" rootProject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key.properties"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndef keystoreProperties "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nkeystoreProperties"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("load")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FileInputStream")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("keystorePropertiesFile"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nandroid "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),s._v("\n")])])]),a("p",[s._v("3.2. 找到以下代码")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("buildTypes "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    release "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// TODO: Add your own signing config for the release build.")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Signing with the debug keys for now, so `flutter run --release` works.")]),s._v("\n        signingConfig signingConfigs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("debug\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("把这段代码替换为：")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("    signingConfigs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        release "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            keyAlias keystoreProperties"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'keyAlias'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n            keyPassword keystoreProperties"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'keyPassword'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n            storeFile "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("keystoreProperties"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'storeFile'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            storePassword keystoreProperties"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'storePassword'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    buildTypes "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        release "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 替换成 release")]),s._v("\n            signingConfig signingConfigs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("release\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("h4",{attrs:{id:"_4-最后一步开始打包apk"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-最后一步开始打包apk"}},[s._v("#")]),s._v(" 4. 最后一步开始打包apk")]),s._v(" "),a("p",[s._v("在Terminal中输入命令 “ "),a("code",[s._v("flutter build apk")]),s._v(" ”")]),s._v(" "),a("p",[s._v("最后生成的apk（app-release.apk）在项目目录的 "),a("code",[s._v("build\\app\\outputs\\apk\\release")]),s._v("里")]),s._v(" "),a("h3",{attrs:{id:"我在打包过程中遇到的报错和踩过的坑"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#我在打包过程中遇到的报错和踩过的坑"}},[s._v("#")]),s._v(" 我在打包过程中遇到的报错和踩过的坑")]),s._v(" "),a("h4",{attrs:{id:"gradle-版本错误"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gradle-版本错误"}},[s._v("#")]),s._v(" "),a("strong",[s._v("gradle")]),s._v(" 版本错误")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2020/1/10/16f8e10f9e21f783?w=984&h=208&f=png&s=18701",alt:"err2"}}),s._v("\n这个错误是版本过低的问题,我们打开"),a("code",[s._v("android/gradle/gradle-wrapper.properties")]),s._v("文件。"),a("br"),s._v("\n把最后一行的"),a("code",[s._v("gradle-4.10.2-all.zip")]),s._v("改为"),a("code",[s._v("gradle-5.6.2-all.zip")]),s._v("后，在把"),a("code",[s._v("build")]),s._v("目录和"),a("code",[s._v("android")]),s._v("目录下的"),a("code",[s._v(".gradle")]),s._v("目录删除重新编译。"),a("br"),s._v("\n注意：是"),a("code",[s._v(".gradle")]),s._v("不是"),a("code",[s._v("gradle")])]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("#Fri Jun "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("08")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("38")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CEST")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),s._v("\ndistributionBase"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GRADLE_USER_HOME")]),s._v("\ndistributionPath"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("wrapper"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dists\nzipStoreBase"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GRADLE_USER_HOME")]),s._v("\nzipStorePath"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("wrapper"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dists\ndistributionUrl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https\\"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("services"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gradle"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("org"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("distributions"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("gradle"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.6")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".2")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("all"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("zip\n\n")])])]),a("p",[s._v("除了以上的原因外,还有其他原因也会导致这个错误出现。例如：项目的应用图标大小与对应的图标目录不一致或者启动页图片有问题，在打包时也会出现这个问题。"),a("br"),s._v("\n推荐使用插件自动生成应用图标。\n"),a("a",{attrs:{href:"https://juejin.im/post/6844904042414473224",target:"_blank",rel:"noopener noreferrer"}},[s._v("flutter_launcher_icons"),a("OutboundLink")],1)]),s._v(" "),a("h4",{attrs:{id:"启动页图片问题报错"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动页图片问题报错"}},[s._v("#")]),s._v(" 启动页图片问题报错")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v(" failed to read "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PNG")]),s._v(" signature"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" file does not start "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PNG")]),s._v(" signature"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])])]),a("p",[s._v("这个问题真是我不小心踩的坑，本来我的启动页图片是"),a("code",[s._v("jpg")]),s._v("文件，但是我把它改成了"),a("code",[s._v("png")]),s._v("图片。"),a("br"),s._v("\n项目开发过程中倒是没出什么问题，但是打包就出现以下的问题了\n"),a("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2020/1/10/16f8e23a5c3d07a8?w=1021&h=155&f=png&s=10552",alt:"err4"}}),s._v("\n把图片格式改回原来的格式就可以正常打包了")])])}),[],!1,null,null,null);t.default=r.exports}}]);